// Teste para handleForecastRequest com diferentes n√≠veis de expertise

async function testForecastRequestLevels() {
    try {
        console.log('üß™ Testando handleForecastRequest com diferentes n√≠veis...\n');

        // Simular fun√ß√£o generateForecastMessageByLevel
        function getWeatherEmoji(description) {
            const desc = description.toLowerCase();
            if (desc.includes('sol') || desc.includes('limpo')) return '‚òÄÔ∏è';
            if (desc.includes('chuva')) return 'üåßÔ∏è';
            if (desc.includes('nuvem')) return '‚òÅÔ∏è';
            if (desc.includes('vento')) return 'üí®';
            return 'üå§Ô∏è';
        }

        function generateForecastMessageByLevel(userLevel, forecastData, days) {
            let forecastMessage = '';

            switch (userLevel) {
                case 'advanced':
                    // N√≠vel avan√ßado: formato t√©cnico e detalhado
                    forecastMessage = `üìä *An√°lise Meteorol√≥gica ${days} Dias - ${forecastData.city}*\n\n`;

                    forecastData.forecasts.slice(0, days).forEach((day, index) => {
                        const emoji = getWeatherEmoji(day.description);
                        const dayName = day.dayName || (index === 0 ? 'Hoje' : index === 1 ? 'Amanh√£' :
                            new Date(day.date).toLocaleDateString('pt-MZ', { weekday: 'long', day: 'numeric', month: 'short' }));

                        forecastMessage += `${emoji} **${dayName}**\n`;
                        forecastMessage += `üå°Ô∏è Amplitude t√©rmica: ${day.minTemp}${forecastData.units} - ${day.maxTemp}${forecastData.units}\n`;
                        forecastMessage += `üìù Condi√ß√µes atmosf√©ricas: ${day.description}\n`;

                        if (day.humidity) {
                            forecastMessage += `üíß Humidade relativa: ${day.humidity}%\n`;
                        }
                        if (day.chanceOfRain && day.chanceOfRain > 0) {
                            forecastMessage += `üåßÔ∏è Probabilidade de precipita√ß√£o: ${day.chanceOfRain}%\n`;
                        }
                        if (day.windSpeed && day.windSpeed > 0) {
                            forecastMessage += `üí® Velocidade do vento: ${day.windSpeed} km/h\n`;
                        }
                        if (day.pressure) {
                            forecastMessage += `üîò Press√£o atmosf√©rica: ${day.pressure} hPa\n`;
                        }
                        if (day.uvIndex) {
                            forecastMessage += `‚òÄÔ∏è √çndice UV: ${day.uvIndex}\n`;
                        }

                        forecastMessage += `\n`;
                    });

                    forecastMessage += `\nüéØ **Recomenda√ß√£o t√©cnica:** Baseie o planeamento das atividades na an√°lise dos par√¢metros meteorol√≥gicos apresentados.`;
                    forecastMessage += `\nüìä _Fonte de dados: ${forecastData.source}_`;
                    break;

                case 'intermediate':
                    // N√≠vel intermedi√°rio: equilibrio entre t√©cnico e acess√≠vel
                    forecastMessage = `üìÖ *Previs√£o Detalhada ${days} Dias - ${forecastData.city}*\n\n`;

                    forecastData.forecasts.slice(0, days).forEach((day, index) => {
                        const emoji = getWeatherEmoji(day.description);
                        const dayName = day.dayName || (index === 0 ? 'Hoje' : index === 1 ? 'Amanh√£' :
                            new Date(day.date).toLocaleDateString('pt-MZ', { weekday: 'long', day: 'numeric' }));

                        forecastMessage += `${emoji} **${dayName}**\n`;
                        forecastMessage += `üå°Ô∏è Temperatura: ${day.minTemp}${forecastData.units} - ${day.maxTemp}${forecastData.units}\n`;
                        forecastMessage += `üìù Condi√ß√µes: ${day.description}\n`;

                        if (day.humidity) {
                            const humidityLevel = day.humidity > 80 ? 'alta' : day.humidity > 60 ? 'moderada' : 'baixa';
                            forecastMessage += `üíß Humidade: ${day.humidity}% (${humidityLevel})\n`;
                        }
                        if (day.chanceOfRain && day.chanceOfRain > 0) {
                            const rainLevel = day.chanceOfRain > 70 ? 'alta probabilidade' : day.chanceOfRain > 40 ? 'poss√≠vel' : 'baixa chance';
                            forecastMessage += `üåßÔ∏è Chuva: ${day.chanceOfRain}% (${rainLevel})\n`;
                        }
                        if (day.windSpeed && day.windSpeed > 0) {
                            const windLevel = day.windSpeed > 20 ? 'vento forte' : day.windSpeed > 10 ? 'brisa moderada' : 'vento leve';
                            forecastMessage += `üí® Vento: ${day.windSpeed} km/h (${windLevel})\n`;
                        }

                        forecastMessage += `\n`;
                    });

                    forecastMessage += `\nüí° **Dica da Joana Bot:** Planifica as atividades considerando estes dados meteorol√≥gicos detalhados!`;
                    forecastMessage += `\nüìä _Dados: ${forecastData.source}_`;
                    break;

                default: // basic
                    // N√≠vel b√°sico: formato simples e amig√°vel
                    forecastMessage = `üìÖ *Previs√£o de ${days} dias para ${forecastData.city}*\n\n`;

                    forecastData.forecasts.slice(0, days).forEach((day, index) => {
                        const emoji = getWeatherEmoji(day.description);
                        const dayName = day.dayName || (index === 0 ? 'Hoje' : index === 1 ? 'Amanh√£' :
                            new Date(day.date).toLocaleDateString('pt-MZ', { weekday: 'long' }));

                        forecastMessage += `${emoji} *${dayName}*\n`;
                        forecastMessage += `   üå°Ô∏è ${day.minTemp}${forecastData.units} - ${day.maxTemp}${forecastData.units}\n`;
                        forecastMessage += `   ${day.description}\n`;

                        // Adicionar informa√ß√µes extras se dispon√≠veis (formato simples)
                        if (day.humidity) {
                            forecastMessage += `   üíß Umidade: ${day.humidity}%\n`;
                        }
                        if (day.chanceOfRain && day.chanceOfRain > 0) {
                            forecastMessage += `   üåßÔ∏è Chuva: ${day.chanceOfRain}%\n`;
                        }
                        if (day.windSpeed && day.windSpeed > 0) {
                            forecastMessage += `   üí® Vento: ${day.windSpeed} km/h\n`;
                        }

                        forecastMessage += `\n`;
                    });

                    forecastMessage += `\nüí° *Dica da Joana Bot:* Planifica as tuas atividades baseado nesta previs√£o!`;
                    forecastMessage += `\nüìä _Dados fornecidos por ${forecastData.source}_`;
                    break;
            }

            return forecastMessage;
        }

        // Dados simulados de previs√£o para 7 dias
        const mockForecastData = {
            city: 'Beira',
            units: '¬∞C',
            source: 'OpenWeatherMap',
            forecasts: [
                {
                    date: '2025-09-12',
                    dayName: 'Hoje',
                    minTemp: 18,
                    maxTemp: 28,
                    description: 'c√©u limpo',
                    humidity: 65,
                    chanceOfRain: 10,
                    windSpeed: 12,
                    pressure: 1015,
                    uvIndex: 7
                },
                {
                    date: '2025-09-13',
                    dayName: 'Amanh√£',
                    minTemp: 20,
                    maxTemp: 30,
                    description: 'parcialmente nublado',
                    humidity: 70,
                    chanceOfRain: 25,
                    windSpeed: 8,
                    pressure: 1012,
                    uvIndex: 6
                },
                {
                    date: '2025-09-14',
                    minTemp: 17,
                    maxTemp: 25,
                    description: 'chuva leve',
                    humidity: 85,
                    chanceOfRain: 75,
                    windSpeed: 15,
                    pressure: 1008,
                    uvIndex: 3
                },
                {
                    date: '2025-09-15',
                    minTemp: 19,
                    maxTemp: 27,
                    description: 'sol com algumas nuvens',
                    humidity: 60,
                    chanceOfRain: 15,
                    windSpeed: 10,
                    pressure: 1018,
                    uvIndex: 8
                },
                {
                    date: '2025-09-16',
                    minTemp: 21,
                    maxTemp: 32,
                    description: 'muito sol',
                    humidity: 55,
                    chanceOfRain: 5,
                    windSpeed: 6,
                    pressure: 1020,
                    uvIndex: 9
                }
            ]
        };

        // Testar os tr√™s n√≠veis
        const levels = ['basic', 'intermediate', 'advanced'];

        for (const level of levels) {
            console.log(`\nüéØ Testando n√≠vel: ${level.toUpperCase()}`);
            console.log('='.repeat(60));

            console.log('üìÖ Gerando previs√£o de 5 dias...');
            const forecastMessage = generateForecastMessageByLevel(level, mockForecastData, 5);

            console.log('\nüìù Mensagem gerada:');
            console.log(forecastMessage);

            // An√°lise da resposta
            const isTechnical = forecastMessage.includes('Amplitude t√©rmica') ||
                forecastMessage.includes('Probabilidade de precipita√ß√£o') ||
                forecastMessage.includes('Humidade relativa') ||
                forecastMessage.includes('Press√£o atmosf√©rica');

            const isBasic = forecastMessage.includes('Dica da Joana Bot') &&
                !forecastMessage.includes('An√°lise Meteorol√≥gica');

            const isIntermediate = forecastMessage.includes('Previs√£o Detalhada') &&
                forecastMessage.includes('(alta)') ||
                forecastMessage.includes('(moderada)') ||
                forecastMessage.includes('(baixa)');

            console.log('\nüîç An√°lise:');
            console.log(`- Formato t√©cnico: ${isTechnical}`);
            console.log(`- Formato b√°sico: ${isBasic}`);
            console.log(`- Formato intermedi√°rio: ${isIntermediate}`);

            // Verificar adequa√ß√£o ao n√≠vel
            let adequate = false;
            switch (level) {
                case 'basic':
                    adequate = isBasic && !isTechnical;
                    break;
                case 'intermediate':
                    adequate = isIntermediate && !forecastMessage.includes('Amplitude t√©rmica');
                    break;
                case 'advanced':
                    adequate = isTechnical && forecastMessage.includes('An√°lise Meteorol√≥gica');
                    break;
            }

            console.log(`‚úÖ Adequado para n√≠vel ${level}: ${adequate}`);

            if (!adequate) {
                console.log(`‚ùå PROBLEMA: Formato n√£o adequado para n√≠vel ${level}!`);
            }

            console.log('\n' + '-'.repeat(60));
        }

    } catch (error) {
        console.error('‚ùå Erro no teste:', error.message);
    }
}

testForecastRequestLevels().then(() => {
    console.log('\n‚úÖ Teste de n√≠veis de forecast completo');
    process.exit(0);
});
